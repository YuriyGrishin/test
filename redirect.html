<!-- saved from url=(0049)https://yuriygrishin.github.io/test/redirect.html -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Redirecting</title>
    <style>
    section{
        position: absolute;
        top: 50%;
        left: 50%;
        margin-right: -50%;
        transform: translate(-50%, -50%)
    }
    dialog {
        width: 100%;
        height: 100%;
    }
    </style>
</head>

<script language=javascript>
var isAndroid = function() {
 return navigator.userAgent.match('Android')
}
function checkParams(){
    var url_string = window.location.href;
    var url = new URL(url_string);
    var r = searchUrlParams("r")
    if(r != null){
        document.getElementById("input_url").value = r;
    }
    var w = searchUrlParams("w")
    if(w != null){
        document.getElementById("input_browser_url").value = w;
    }
    var p = searchUrlParams("p")
    if(p != null){
        document.getElementById("input_produt").value = p;
    }

    var hasRedirect = getRedirectLink() != null
    console.log("hasRedirect="+hasRedirect)
    if (hasRedirect){
        if (isAndroid()){
            console.log("isAndroid()="+isAndroid())
            document.getElementById("dialog_with_reference_open_link").hidden = false
        } else {
            goToLink()
        }
    }
}

function searchUrlParams(value) {
    var url_string = window.location.href;
    var url = new URL(url_string);
    return url.searchParams.get(value)
}

function getRedirectLink(){
    var w = searchUrlParams("w")
    var w_go = "true"===searchUrlParams("w_go")
    if(w != null && w_go){
        return "beru://browser?hybrid-mode=1&url=" + encodeURIComponent(w)
    }
    var p = searchUrlParams("p")
    var p_go = "true"===searchUrlParams("p_go")
    if(p != null && p_go){
        return "beru://product/" + encodeURIComponent(p)
    }
    return null
}

function goToLink(){
    var link = getRedirectLink()
    if(link != null){
        parent.location = link
    }
}


</script>
<meta name="referrer" content="origin">
<body style="" onload="checkParams()">

<section>

    <dialog open id="dialog_with_reference_open_link" hidden>
        <input type="button"
               onclick="goToLink()"
               id="go_to_link"
               value="Перейти по ссылке"/>
        <area>
        <input type="button"
               onclick="document.getElementById(&#39;dialog_with_reference_open_link&#39;).hidden=true"
               id="close_dialog"
               value="Закрыть диалог"/>
    </dialog>

    <b>Простой диплинк</b><br>
    <input type="text" size="100" id="input_url" name="r" value="" autocapitalize="off" required=""/>
    <br>
    <input type="button" onclick="parent.location=document.getElementById(&#39;input_url&#39;).value" value="Перейти"/>
    <br>
    <br>

    <b>Протестировать WebView|WebKit beru://browser?hybrid-mode=1&amp;url=</b><br>
    <input type="text" size="100" id="input_browser_url" name="w" value="" autocapitalize="off" autofocus=""
           required=""/>
    <br>
    <input type="button"
           onclick="parent.location=&#39;beru://browser?hybrid-mode=1&amp;url=&#39;+encodeURIComponent(document.getElementById(&#39;input_browser_url&#39;).value)"
           id="input_browser_url_button"
           name="w_go"
           value="Перейти"/>
    <input type="button"
           onclick="navigator.clipboard.writeText(&#39;beru://browser?hybrid-mode=1&amp;url=&#39;+encodeURIComponent(document.getElementById(&#39;input_browser_url&#39;).value))"
           value="Скопировать получившуюся ссылку"/>
    <br>
    <br>

    <a href="beru://my/cart">Корзина beru://my/cart</a>
    <br>
    <br>

    <a href="beru://product/100427327869">iPhone beru://product/100427327869</a>
    <br>
    <br>

    <b>Протестировать beru://product/</b><br>
    <input type="text" size="100" id="input_produt" name="p" value="" autocapitalize="off" required=""/>
    <br>
    <input type="button"
           id="input_product_button"
           onclick="parent.location=&#39;beru://product/&#39;+encodeURIComponent(document.getElementById(&#39;input_produt&#39;).value)"
           referrerpolicy="origin"
           value="Перейти на товар"/>
    <br>
    <br>


    <a href="beru://my/orders">Мои заказы beru://my/orders</a>
    <br>
    <br>

    <a href="beru://my/profile">Профиль beru://my/profile</a>
    <br>
    <br>

    <a href="beru://search">Поиск beru://search</a>
    <br>
    <br>

    <a href="beru://deals">Скидки beru://deals</a>
    <br>
    <br>

    <a href="beru://bonus">Мои бонусы beru://bonus</a>
    <br>
    <br>

    <a href="beru://wishlist">Вишлист beru://wishlist</a>
    <br>
    <br>

    <a href="beru://help/feedback">Форма обратной связи beru://help/feedback</a>
    <br>
    <br>

</section>
</body>
</html>
